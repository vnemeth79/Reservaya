generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  password      String
  role          UserRole
  salonId       String?      @map("salon_id")
  salon         Salon?       @relation(fields: [salonId], references: [id])
  staffMemberId String?      @unique @map("staff_member_id")
  staffMember   StaffMember? @relation(fields: [staffMemberId], references: [id])
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")

  @@map("users")
}

enum UserRole {
  SUPER_ADMIN
  SALON_OWNER
  SALON_STAFF
}

model Salon {
  id                 String             @id @default(cuid())
  name               String
  slug               String             @unique
  phone              String
  address            String?
  ownerEmail         String             @map("owner_email")
  subscriptionStatus SubscriptionStatus @default(TRIAL) @map("subscription_status")
  trialEndsAt        DateTime?          @map("trial_ends_at")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")

  users        User[]
  staffMembers StaffMember[]
  services     Service[]
  bookings     Booking[]
  workingHours WorkingHours[]

  @@map("salons")
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  SUSPENDED
  CANCELLED
}

model StaffMember {
  id        String   @id @default(cuid())
  salonId   String   @map("salon_id")
  salon     Salon    @relation(fields: [salonId], references: [id], onDelete: Cascade)
  name      String
  services  String[] // Array of service IDs they can perform
  photoUrl  String?  @map("photo_url")
  active    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")

  user         User?
  bookings     Booking[]
  workingHours WorkingHours[]

  @@map("staff_members")
}

model Service {
  id              String   @id @default(cuid())
  salonId         String   @map("salon_id")
  salon           Salon    @relation(fields: [salonId], references: [id], onDelete: Cascade)
  name            String
  durationMinutes Int      @map("duration_minutes")
  price           Float?
  active          Boolean  @default(true)
  createdAt       DateTime @default(now()) @map("created_at")

  bookings Booking[]

  @@map("services")
}

model Booking {
  id              String        @id @default(cuid())
  salonId         String        @map("salon_id")
  salon           Salon         @relation(fields: [salonId], references: [id], onDelete: Cascade)
  staffId         String        @map("staff_id")
  staff           StaffMember   @relation(fields: [staffId], references: [id])
  serviceId       String        @map("service_id")
  service         Service       @relation(fields: [serviceId], references: [id])
  customerName    String        @map("customer_name")
  customerPhone   String        @map("customer_phone")
  customerEmail   String?       @map("customer_email")
  bookingDatetime DateTime      @map("booking_datetime")
  status          BookingStatus @default(CONFIRMED)
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@index([salonId, bookingDatetime])
  @@index([customerPhone])
  @@map("bookings")
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

model WorkingHours {
  id        String       @id @default(cuid())
  salonId   String       @map("salon_id")
  salon     Salon        @relation(fields: [salonId], references: [id], onDelete: Cascade)
  staffId   String?      @map("staff_id") // NULL = applies to all staff
  staff     StaffMember? @relation(fields: [staffId], references: [id], onDelete: Cascade)
  dayOfWeek Int          @map("day_of_week") // 0=Domingo, 1=Lunes...6=SÃ¡bado
  startTime String       @map("start_time") // "09:00"
  endTime   String       @map("end_time") // "18:00"

  @@map("working_hours")
}

